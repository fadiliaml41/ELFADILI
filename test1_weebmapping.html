<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Découvrez le Tram Rabat-Salé</title>
    
    <!-- Inclure Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Inclure Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Inclure le plugin Leaflet MiniMap CSS et JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-minimap@3.6.1/dist/Control.MiniMap.min.css" />
    <script src="https://unpkg.com/leaflet-minimap@3.6.1/dist/Control.MiniMap.min.js"></script>

    <style>
        html, body {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        #landing {
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: url('desktop wallpaper 4k.jpeg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        #discover-button {
            padding: 15px 30px;
            font-size: 18px;
            cursor: pointer;
            background-color: #014421;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        #discover-button:hover {
            background-color: #014421;
        }
        #map-container {
            display: none;
            height: 100%;
        }
        #map {
            height: 100%;
            width: 100%;
        }
    </style>
</head>
<body>

<div id="landing">
    <button id="discover-button">Découvrir le Tram Rabat-Salé</button>
</div>

<div id="map-container">
    <div id="map"></div>
</div>

<script src="stations_tram.js" type="text/javascript"></script>
<script src="decup_admin.js" type="text/javascript"></script>
<script src="tram1_2.js" type="text/javascript"></script>

<script>
    document.getElementById('discover-button').addEventListener('click', function() {
        document.getElementById('landing').style.display = 'none';
        document.getElementById('map-container').style.display = 'block';
        initMap();
    });

    function initMap() {
        const map = L.map('map').setView([34.02, -6.83], 13); // Centré sur Rabat

        const tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        const marker = L.marker([34.02, -6.83]).addTo(map)
            .bindPopup('<b>Hello !</b><br />').openPopup();

        const popup = L.popup()
            .setLatLng([34.02, -6.83])
            .setContent('Welcome to Rabat.')
            .openOn(map);

        function onMapClick(e) {
            popup
                .setLatLng(e.latlng)
                .setContent(`You clicked the map at ${e.latlng.toString()}`)
                .openOn(map);
        }

        map.on('click', onMapClick);

        // Ajout de couches GeoJSON
        L.geoJSON(decup_admin, {
            style: function(feature) {
                return {
                    color: '#ff7800', 
                    weight: 2, 
                    opacity: 1, 
                    fillColor: '#e8f48c', 
                    fillOpacity: 0.5 
                };
            },
            onEachFeature: function(feature, layer) {
                if (feature.properties && feature.properties.shapeName) {
                    layer.bindPopup(feature.properties.shapeName);
                }
            }
        }).addTo(map);

        // Ajouter les lignes de tram avec minZoom et maxZoom
        const tramLines = L.geoJSON(tram1_2, {
            style: function(feature) {
                let lineColor, lineWeight;
                if (feature.properties.ref === '1') {
                    lineColor = '#ff4500'; 
                    lineWeight = 2.5;        
                } else if (feature.properties.ref === '2') {
                    lineColor = '#3f00ff'; 
                    lineWeight = 4;        
                } else {
                    lineColor = '#000000'; 
                    lineWeight = 1;        
                }
                return {
                    color: lineColor,  
                    weight: lineWeight, 
                    opacity: 0.65
                };
            },
            onEachFeature: function(feature, layer) {
                if (feature.properties && feature.properties.name) {
                    layer.bindPopup(feature.properties.name);
                }
            }
        });

        // Ajouter les stations de tram avec minZoom et maxZoom
        const tramStations = L.geoJSON(stations_tram, {
            pointToLayer: function(feature, latlng) {
                return L.circleMarker(latlng, {
                    radius: 4, 
                    fillColor: '#ff7800',
                    color: '#000',
                    weight: 0.5,
                    opacity: 1,
                    fillOpacity: 0.8
                });
            },
            onEachFeature: function(feature, layer) {
                if (feature.properties && feature.properties.name) {
                    layer.bindPopup(feature.properties.name);
                }
            }
        });

        // Ajouter les couches à différents niveaux de zoom
        map.on('zoomend', function() {
            const zoomLevel = map.getZoom();

            // Afficher les lignes de tram uniquement à partir du zoom 14
            if (zoomLevel >= 10) {
                map.addLayer(tramLines);
            } else {
                map.removeLayer(tramLines);
            }

            // Afficher les stations de tram uniquement à partir du zoom 16
            if (zoomLevel >= 12) {
                map.addLayer(tramStations);
            } else {
                map.removeLayer(tramStations);
            }
        });

        // Initialiser la carte au niveau de zoom actuel
        const initialZoom = map.getZoom();
        if (initialZoom >= 5) {
            map.addLayer(tramLines);
        }
        if (initialZoom >= 2) {
            map.addLayer(tramStations);
        }

        // Ajout de la mini-carte (minimap)
        const miniMapTiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        });

        const miniMap = new L.Control.MiniMap(miniMapTiles, {
            toggleDisplay: true,  // Ajoute un bouton pour masquer ou afficher la minimap
            minimized: false,     // Afficher la minimap au démarrage
            zoomLevelOffset: -8,   // Niveau de zoom pour afficher tout le Maroc
        }).addTo(map);

        // Dessiner un rectangle autour de la région de Rabat
        const rabatBounds = [
            [33.85, -6.97], // Sud-Ouest de Rabat
            [34.10, -6.67]  // Nord-Est de Rabat
        ];
        const rabatRectangle = L.rectangle(rabatBounds, {color: "#ff7800", weight: 1}).addTo(miniMap._miniMap);
    }
</script>

</body>
</html>
